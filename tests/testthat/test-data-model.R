test_that("Test merge_precid_4_isobars.",{
    orig_precids = 1L:10L
    masses = c(1.,1.5,2.5,2.6,2.65,3.5,3.6,3.7,5,6)
    up_masses = c(1.2,2.4,2.7,2.9,2.85,3.59,3.9,4,5.5,6.5)
    x = merge_precid_4_isobars(orig_precids,masses,up_masses)
    expect_equal(x,c(1L,2L,3L,3L,3L,6L,7L,7L,9L,10))

    orig_precids = integer(0)
    masses = numeric(0)
    up_masses = numeric(0)
    x = merge_precid_4_isobars(orig_precids,masses,up_masses)
    expect_equal(x,integer(0))
    
    
})

test_that("Test merge_precid_4_isobars on real data.",{
    orig = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20)
    msms = c(76.039304862,90.054954926,106.049869546,116.07060499,118.086255054,120.06551961,122.027025656,132.101905118,132.101905118,133.060768588,134.044784166,147.076418652,147.11280416,148.06043423,150.058325784,156.07675301,166.086255054,175.11895218,182.081169674,205.097154096)
    up = c(76.0400652550486,90.0558554755493,106.050930044695,116.07176569605,118.087435916551,120.066720265196,122.028245926257,132.103226137051,132.103226137051,133.062099195686,134.046124613842,147.077889416187,147.114275288042,148.061914834342,150.059826367258,156.07831377753,166.087915916551,175.120703369522,182.082990485697,205.099205067541)

    x = merge_precid_4_isobars(orig,msms,up)
    expect_equal(x,c(1,2,3,4,5,6,7,8,8,10,11,12,13,14,15,16,17,18,19,20))
})
